var NIUA=class a{static #timer;static #niupSessionUpdateTime;static #niupLastActivityTime;constructor(e){this.appConfig=e}static getNIUA(e){return e.hasOwnProperty("minutesBeforeExpire")||(e.minutesBeforeExpire=5),e.hasOwnProperty("apikey")||(e.apikey="there_is_no_apikey"),new a(e)}async ready(){console.log("NIUA instance has been initialized.")}isIE(){const e=navigator.userAgent;return-1<e.indexOf("MSIE ")||-1<e.indexOf("Trident/")}getCookie(e){var t,i=e+"=";for(t of document.cookie.split(";"))if(t=t.trimStart(),t.startsWith(i))return t.slice(i.length);return null}async getSession(){var e=this.getCookie("profile_id");return null!=e?{loggedIn:!0,profileId:e}:{loggedIn:!1}}async #makeCachedRequest(e,t){var i=sessionStorage.getItem(t);if(i)try{var s=JSON.parse(i),a=(new Date).getTime()-60*this.appConfig.minutesBeforeExpire*1e3;if(parseInt(s.timestamp)>=a)return s}catch(e){console.log("Ignoring cached value for %s because it couldn't be parsed: %o",t,e)}e={response:await this.getResponse(e),timestamp:(new Date).getTime()};return sessionStorage.setItem(t,JSON.stringify(e)),e}async getEmail(){if(null==this.getCookie("profile_id"))return sessionStorage.removeItem("NIUA_email_addr"),{response:{email:"user_not_logged_in",success:!1},timestamp:(new Date).getTime()};try{return await this.#makeCachedRequest("email","NIUA_email_addr")}catch(e){return console.log(e),{response:{email:"webservice_error",success:!1},timestamp:(new Date).getTime()}}}#makeFailureObject(){return{response:{success:!1},timestamp:(new Date).getTime()}}async getMonogram(){if(null==this.getCookie("profile_id"))return sessionStorage.removeItem("NIUA_monogram"),this.#makeFailureObject();try{return await this.#makeCachedRequest("monogram","NIUA_monogram")}catch(e){return console.log(e),this.#makeFailureObject()}}async getDetails(){if(null==this.getCookie("profile_id"))return sessionStorage.removeItem("NIUA_details"),this.#makeFailureObject();try{return await this.#makeCachedRequest("details","NIUA_details")}catch(e){return console.log(e),this.#makeFailureObject()}}getEnvFromUrl(){for(const e of["-test2","-test","-dev2","-dev"])if(location.hostname.includes(e))return e;return""}getResponse(s){return null==s&&(s="email"),new Promise((e,t)=>{const i=new XMLHttpRequest;i.open("GET","//flux"+this.getEnvFromUrl()+".ni.com/niuadataservice/1/resources/"+s),i.withCredentials=!0,this.addAuthorization(i),this.addApiKey(i),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?e:t)(JSON.parse(i.response))},i.send()})}createNIAuthToken(){var e=this.getCookie("profile_id");if(null==e)return null;var t=this.getCookie("rma")??"",i=this.getCookie("rmac")??"",s=this.getCookie("upsid")??"";return"1|"+btoa(e+"|"+t+"|"+i+"|"+s)}addAuthorization(e){var t=this.createNIAuthToken();null!=t&&e.setRequestHeader("X-NI-Auth-Token",t)}addApiKey(e){null!=this.appConfig.apikey&&null!=this.appConfig.apikey&&e.setRequestHeader("X-NI-API-KEY",this.appConfig.apikey)}callUpdateSession(a){return new Promise((e,t)=>{const i=new XMLHttpRequest;var s=JSON.stringify(a);i.open("POST","//flux"+this.getEnvFromUrl()+".ni.com/niuadataservice/1/resources/updateSession"),i.withCredentials=!0,this.addAuthorization(i),this.addApiKey(i),i.setRequestHeader("Content-Type","application/json; charset=utf-8"),i.setRequestHeader("Accept","application/json"),i.onreadystatechange=function(){4===i.readyState&&(201===i.status?e:t)(JSON.parse(i.response))},i.send(s)})}async updateSession(){a.#niupSessionUpdateTime=(new Date).getTime();var e=this.getCookie("upsid");if(null!=e){e={upsid:e,timestamp:a.#niupLastActivityTime};try{var t=await this.callUpdateSession(e);this.setTimer(t.relativeTimeout)}catch(e){console.log(e)}}}setNIUPActivity(){a.#niupLastActivityTime=(new Date).getTime()}setTimer(e){let t,i;var s=this.updateSession.bind(this);null==a.#timer?(t=60*(e-1)*1e3,i=t/6e4,a.#timer=setTimeout(s,t)):(t=a.#niupLastActivityTime+30*(e-1)*1e3-a.#niupSessionUpdateTime,i=t/6e4,0<t&&(a.#timer=setTimeout(s,t)))}};window.addEventListener("DOMContentLoaded",function(){NIUA.prototype.getCookie("profile_id")||(sessionStorage.removeItem("NIUA_email_addr"),sessionStorage.removeItem("NIUA_details"));const e=NIUA.getNIUA({minutesBeforeExpire:2,apikey:"3b7c1d3b-275d-4683-a459-36e3d1d21776"});e.setNIUPActivity(),e.updateSession();var t=e.setNIUPActivity.bind(e);window.addEventListener("click",t),window.addEventListener("touchstart",t),window.addEventListener("keypress",t)},{once:!0});
